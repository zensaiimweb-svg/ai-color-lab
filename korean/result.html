<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE COVE - ì§„ë‹¨ ê²°ê³¼</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        .result-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 3rem 2rem;
        }

        .result-header {
            text-align: center;
            margin-bottom: 4rem;
            animation: fadeInUp 0.6s ease-out;
        }

        .result-title {
            font-family: var(--font-display);
            font-size: clamp(2.5rem, 5vw, 4rem);
            color: var(--color-black);
            margin-bottom: 1rem;
        }

        .result-subtitle {
            font-size: 1.2rem;
            color: var(--color-slate);
        }

        .result-card {
            background: white;
            padding: 4rem 3rem;
            border-radius: 12px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.1);
            margin-bottom: 3rem;
            animation: fadeInUp 0.8s ease-out;
        }

        .season-result {
            text-align: center;
            margin-bottom: 3rem;
            padding-bottom: 3rem;
            border-bottom: 2px solid var(--color-sand);
        }

        .season-icon-large {
            font-size: 6rem;
            display: block;
            margin-bottom: 1.5rem;
        }

        .season-name-large {
            font-family: var(--font-display);
            font-size: 3rem;
            color: var(--color-black);
            margin-bottom: 0.5rem;
        }

        .season-type-large {
            font-size: 1.3rem;
            color: var(--color-slate);
            font-style: italic;
            margin-bottom: 2rem;
        }

        .season-description-large {
            font-size: 1.1rem;
            color: var(--color-slate);
            line-height: 1.8;
            max-width: 600px;
            margin: 0 auto;
        }

        .color-palette {
            margin-bottom: 3rem;
        }

        .palette-title {
            font-family: var(--font-display);
            font-size: 1.8rem;
            color: var(--color-black);
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .palette-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .palette-color {
            aspect-ratio: 1;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .palette-color:hover {
            transform: scale(1.1);
        }

        .recommendations {
            margin-bottom: 3rem;
        }

        .recommendation-section {
            margin-bottom: 2rem;
        }

        .recommendation-title {
            font-size: 1.3rem;
            font-weight: 500;
            color: var(--color-black);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .recommendation-content {
            color: var(--color-slate);
            line-height: 1.7;
            padding-left: 2rem;
        }

        .recommendation-list {
            list-style: none;
            padding: 0;
        }

        .recommendation-list li {
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
        }

        .recommendation-list li::before {
            content: 'â€¢';
            position: absolute;
            left: 0;
            color: var(--color-accent);
            font-size: 1.5rem;
        }

        .data-summary {
            background: var(--color-cream);
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 3rem;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1.5rem;
        }

        .summary-item {
            text-align: center;
        }

        .summary-label {
            font-size: 0.85rem;
            color: var(--color-slate);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        .summary-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--color-black);
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 1.2rem 3rem;
            font-family: var(--font-body);
            font-size: 1rem;
            font-weight: 400;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--color-black);
            color: var(--color-cream);
            position: relative;
            overflow: hidden;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: var(--color-accent);
            transform: translate(-50%, -50%);
            transition: width 0.6s ease, height 0.6s ease;
        }

        .btn-primary:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary span {
            position: relative;
            z-index: 1;
        }

        .btn-secondary {
            background: transparent;
            color: var(--color-charcoal);
            border: 2px solid var(--color-sand);
        }

        .btn-secondary:hover {
            border-color: var(--color-accent);
            background: var(--color-sand);
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-content {
            text-align: center;
            color: white;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .result-container {
                padding: 2rem 1.5rem;
            }

            .result-card {
                padding: 2.5rem 2rem;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }

        /* Print styles */
        @media print {
            body {
                background: white;
            }
            
            .action-buttons,
            .btn {
                display: none !important;
            }
        }

        /* Comparison Analysis Styles */
        .comparison-analysis {
            margin-top: 3rem;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .comparison-card {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            border: 3px solid var(--color-sand);
            text-align: center;
        }

        .comparison-header {
            margin-bottom: 1.5rem;
        }

        .comparison-icon {
            font-size: 2.5rem;
            display: block;
            margin-bottom: 0.5rem;
        }

        .comparison-header h4 {
            font-size: 1.1rem;
            color: var(--color-slate);
            font-weight: 400;
        }

        .comparison-season {
            font-size: 1.8rem;
            font-family: var(--font-display);
            color: var(--color-black);
            margin-bottom: 0.5rem;
        }

        .comparison-type {
            color: var(--color-slate);
            font-style: italic;
        }

        .comparison-confidence {
            color: var(--color-accent);
            font-weight: 600;
            margin-top: 0.5rem;
        }

        .match-status {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            border: 3px solid;
        }

        .match-status.match {
            border-color: #4CAF50;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.05) 0%, white 100%);
        }

        .match-status.mismatch {
            border-color: #FF9800;
            background: linear-gradient(135deg, rgba(255, 152, 0, 0.05) 0%, white 100%);
        }

        .match-icon {
            font-size: 2rem;
        }

        .match-text {
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--color-black);
            margin: 0;
        }

        .detailed-analysis {
            background: var(--color-cream);
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }

        .detail-title {
            font-family: var(--font-display);
            font-size: 1.5rem;
            color: var(--color-black);
            margin-bottom: 1.5rem;
        }

        .analysis-details {
            display: grid;
            gap: 1rem;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem 0;
            border-bottom: 1px solid var(--color-sand);
        }

        .detail-item:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 500;
            color: var(--color-charcoal);
        }

        .detail-value {
            color: var(--color-slate);
            font-weight: 600;
        }

        .expert-opinion {
            background: linear-gradient(135deg, rgba(157, 139, 124, 0.08) 0%, white 100%);
            padding: 2rem;
            border-radius: 12px;
            border: 3px solid var(--color-accent);
            margin-bottom: 2rem;
        }

        .expert-title {
            font-family: var(--font-display);
            font-size: 1.5rem;
            color: var(--color-black);
            margin-bottom: 1.5rem;
        }

        .opinion-content p {
            margin-bottom: 1rem;
            line-height: 1.8;
            color: var(--color-slate);
        }

        .opinion-content strong {
            color: var(--color-black);
        }

        .compromise-section {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            border: 3px solid var(--color-accent-light);
            margin-top: 2rem;
        }

        .compromise-title {
            font-family: var(--font-display);
            font-size: 1.5rem;
            color: var(--color-black);
            margin-bottom: 1rem;
        }

        .compromise-intro {
            color: var(--color-slate);
            margin-bottom: 1.5rem;
            line-height: 1.7;
        }

        .compromise-palette {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .compromise-color {
            aspect-ratio: 1;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .compromise-color:hover {
            transform: scale(1.1);
        }

        .compromise-tips {
            background: var(--color-cream);
            padding: 1.5rem;
            border-radius: 8px;
        }

        .compromise-tips p {
            font-weight: 600;
            margin-bottom: 0.8rem;
            color: var(--color-black);
        }

        .compromise-tips ul {
            list-style: none;
            padding: 0;
        }

        .compromise-tips li {
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
            color: var(--color-slate);
        }

        .compromise-tips li::before {
            content: 'â†’';
            position: absolute;
            left: 0;
            color: var(--color-accent);
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .comparison-grid {
                grid-template-columns: 1fr;
            }

            .compromise-palette {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p>PDFë¥¼ ìƒì„±í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
        </div>
    </div>

    <section class="hero-section" style="min-height: auto; padding: 2rem;">
        <div class="result-container">
            <div class="result-header">
                <p class="welcome-subtitle">Personal Color Analysis Result</p>
                <h1 class="result-title">ì§„ë‹¨ ê²°ê³¼</h1>
                <p class="result-subtitle">ë‹¹ì‹ ì˜ í¼ìŠ¤ë„ ì»¬ëŸ¬ë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
            </div>

            <div class="result-card" id="resultCard">
                <!-- Season Result -->
                <div class="season-result">
                    <span class="season-icon-large" id="seasonIcon">ğŸŒ¸</span>
                    <h2 class="season-name-large" id="seasonName">ë´„ ì›œí†¤</h2>
                    <p class="season-type-large" id="seasonType">Spring Warm</p>
                    <p class="season-description-large" id="seasonDescription">
                        ë°ê³  í™”ì‚¬í•œ ë”°ëœ»í•œ í†¤ì´ ë‹¹ì‹ ì—ê²Œ ê°€ì¥ ì˜ ì–´ìš¸ë¦½ë‹ˆë‹¤.
                    </p>
                </div>

                <!-- Color Palette -->
                <div class="color-palette">
                    <h3 class="palette-title">ì¶”ì²œ ì»¬ëŸ¬ íŒ”ë ˆíŠ¸</h3>
                    <div class="palette-grid" id="paletteGrid">
                        <!-- Colors will be inserted here -->
                    </div>
                </div>

                <!-- Recommendations -->
                <div class="recommendations">
                    <div class="recommendation-section">
                        <h4 class="recommendation-title">
                            <span>ğŸ‘—</span>
                            ì˜ë¥˜ ì¶”ì²œ
                        </h4>
                        <div class="recommendation-content">
                            <ul class="recommendation-list" id="clothingRec"></ul>
                        </div>
                    </div>

                    <div class="recommendation-section">
                        <h4 class="recommendation-title">
                            <span>ğŸ’„</span>
                            ë©”ì´í¬ì—… ì¶”ì²œ
                        </h4>
                        <div class="recommendation-content">
                            <ul class="recommendation-list" id="makeupRec"></ul>
                        </div>
                    </div>

                    <div class="recommendation-section">
                        <h4 class="recommendation-title">
                            <span>ğŸ’</span>
                            ì•¡ì„¸ì„œë¦¬ ì¶”ì²œ
                        </h4>
                        <div class="recommendation-content">
                            <ul class="recommendation-list" id="accessoryRec"></ul>
                        </div>
                    </div>
                </div>

                <!-- Data Summary -->
                <div class="data-summary">
                    <div class="summary-grid">
                        <div class="summary-item">
                            <p class="summary-label">ì„ í˜¸ ìŠ¤íƒ€ì¼</p>
                            <p class="summary-value" id="styleSummary">-</p>
                        </div>
                        <div class="summary-item">
                            <p class="summary-label">ì˜ˆìƒ í¼ì»¬</p>
                            <p class="summary-value" id="expectedSummary">-</p>
                        </div>
                        <div class="summary-item">
                            <p class="summary-label">í‰ê·  í”¼ë¶€í†¤</p>
                            <p class="summary-value" id="rgbSummary">-</p>
                        </div>
                        <div class="summary-item">
                            <p class="summary-label">ìµœì¢… ì„ íƒ</p>
                            <p class="summary-value" id="finalSeasonSummary">-</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="downloadPDF()">
                    <span>ğŸ“„ PDF ë‹¤ìš´ë¡œë“œ</span>
                </button>
                <button class="btn btn-secondary" onclick="restartDiagnosis()">
                    <span>ğŸ”„ ë‹¤ì‹œ ì§„ë‹¨í•˜ê¸°</span>
                </button>
                <button class="btn btn-secondary" onclick="goHome()">
                    <span>ğŸ  í™ˆìœ¼ë¡œ</span>
                </button>
            </div>
        </div>
    </section>

    <script>
        const seasonData = {
            spring: {
                icon: 'ğŸŒ¸',
                name: 'ë´„ ì›œí†¤',
                type: 'Spring Warm',
                description: 'ë°ê³  í™”ì‚¬í•œ ë”°ëœ»í•œ í†¤ì´ ë‹¹ì‹ ì—ê²Œ ê°€ì¥ ì˜ ì–´ìš¸ë¦½ë‹ˆë‹¤. ìƒê¸° ë„˜ì¹˜ëŠ” ì»¬ëŸ¬ë¡œ ìì—°ìŠ¤ëŸ¬ìš´ í™”ì‚¬í•¨ì„ í‘œí˜„í•˜ì„¸ìš”.',
                colors: ['#FFB399', '#FFD93D', '#FFB6C1', '#FFE4B5', '#FFDAB9', '#FFA07A'],
                clothing: ['í”¼ì¹˜, ì½”ë„ ì»¬ëŸ¬ì˜ ìƒì˜', 'ì•„ì´ë³´ë¦¬, í¬ë¦¼ ì»¬ëŸ¬ ì…”ì¸ ', 'ì—°í•œ ì¹´í‚¤, ë¯¼íŠ¸ ê·¸ë¦°', 'ë°ì€ í†¤ì˜ ë°ë‹˜'],
                makeup: ['ì½”ë„ í•‘í¬ ë¦½ìŠ¤í‹±', 'í”¼ì¹˜ ë¸”ëŸ¬ì…”', 'ê³¨ë“œ ì•„ì´ì„€ë„ìš°', 'ë¸Œë¼ìš´ ê³„ì—´ ì•„ì´ë¼ì´ë„ˆ'],
                accessory: ['ê³¨ë“œ ì£¼ì–¼ë¦¬', 'ë”°ëœ»í•œ í†¤ì˜ ê°€ì£½ ì†Œí’ˆ', 'ë°ì€ ìƒ‰ìƒì˜ ìŠ¤ì¹´í”„']
            },
            summer: {
                icon: 'ğŸŒŠ',
                name: 'ì—¬ë¦„ ì¿¨í†¤',
                type: 'Summer Cool',
                description: 'ë¶€ë“œëŸ½ê³  ìš°ì•„í•œ ì‹œì›í•œ í†¤ì´ ë‹¹ì‹ ì—ê²Œ ê°€ì¥ ì˜ ì–´ìš¸ë¦½ë‹ˆë‹¤. ì€ì€í•˜ê³  ì„¸ë ¨ëœ ì»¬ëŸ¬ë¡œ í’ˆê²©ì„ ë”í•˜ì„¸ìš”.',
                colors: ['#B0C4DE', '#DDA0DD', '#FFB3D9', '#B0E0E6', '#D8BFD8', '#E6E6FA'],
                clothing: ['ë¼ë²¤ë”, ì†Œí”„íŠ¸ í•‘í¬ ë¸”ë¼ìš°ìŠ¤', 'ê·¸ë ˆì´, ë„¤ì´ë¹„ ê³„ì—´', 'íŒŒìŠ¤í…” ë¸”ë£¨ ë°ë‹˜', 'ì‹¤ë²„ ê·¸ë ˆì´ ë‹ˆíŠ¸'],
                makeup: ['ë¡œì¦ˆ í•‘í¬ ë¦½ìŠ¤í‹±', 'ë¼ë²¤ë” ì•„ì´ì„€ë„ìš°', 'ì‹¤ë²„ í•˜ì´ë¼ì´í„°', 'ì¿¨í†¤ ë¸Œë¼ìš´ ë§ˆìŠ¤ì¹´ë¼'],
                accessory: ['ì‹¤ë²„ ì£¼ì–¼ë¦¬', 'í„ ì•¡ì„¸ì„œë¦¬', 'ì‹œì›í•œ í†¤ì˜ ìŠ¤ì¹´í”„']
            },
            autumn: {
                icon: 'ğŸ',
                name: 'ê°€ì„ ì›œí†¤',
                type: 'Autumn Warm',
                description: 'ê¹Šê³  í’ì„±í•œ ë”°ëœ»í•œ í†¤ì´ ë‹¹ì‹ ì—ê²Œ ê°€ì¥ ì˜ ì–´ìš¸ë¦½ë‹ˆë‹¤. ìì—°ìŠ¤ëŸ¬ìš´ ê¹Šì´ê°ìœ¼ë¡œ ê³ ê¸‰ìŠ¤ëŸ¬ì›€ì„ ì—°ì¶œí•˜ì„¸ìš”.',
                colors: ['#D2691E', '#CD853F', '#A0522D', '#8B4513', '#DEB887', '#BC8F8F'],
                clothing: ['í…Œë¼ì½”íƒ€, ë²„ê±´ë”” ë‹ˆíŠ¸', 'ì¹´í‚¤, ì˜¬ë¦¬ë¸Œ ê·¸ë¦° ì•„ìš°í„°', 'ë¨¸ìŠ¤íƒ€ë“œ ì˜ë¡œìš°', 'ì´ˆì½œë¦¿ ë¸Œë¼ìš´'],
                makeup: ['ë¸Œë¦­ ë ˆë“œ ë¦½ìŠ¤í‹±', 'í…Œë¼ì½”íƒ€ ë¸”ëŸ¬ì…”', 'ë¸Œë¡ ì¦ˆ ì•„ì´ì„€ë„ìš°', 'ë‹¤í¬ ë¸Œë¼ìš´ ì•„ì´ë¼ì´ë„ˆ'],
                accessory: ['ê³¨ë“œ ì£¼ì–¼ë¦¬', 'ê°€ì£½ ì†Œí’ˆ', 'ë”°ëœ»í•œ ë¸Œë¼ìš´ ë²¨íŠ¸']
            },
            winter: {
                icon: 'â„ï¸',
                name: 'ê²¨ìš¸ ì¿¨í†¤',
                type: 'Winter Cool',
                description: 'ì„ ëª…í•˜ê³  ê°•ë ¬í•œ ì‹œì›í•œ í†¤ì´ ë‹¹ì‹ ì—ê²Œ ê°€ì¥ ì˜ ì–´ìš¸ë¦½ë‹ˆë‹¤. ëšœë ·í•œ ëŒ€ë¹„ë¡œ ì¹´ë¦¬ìŠ¤ë§ˆë¥¼ í‘œí˜„í•˜ì„¸ìš”.',
                colors: ['#000080', '#4169E1', '#0000CD', '#191970', '#DC143C', '#FF1493'],
                clothing: ['í“¨ì–´ í™”ì´íŠ¸, ë¸”ë™', 'ë¡œì–„ ë¸”ë£¨, ë„¤ì´ë¹„', 'ì—ë©”ë„ë“œ ê·¸ë¦°', 'ìì£¼ìƒ‰, ì™€ì¸'],
                makeup: ['í“¨ì‹œì•„ í•‘í¬ ë¦½ìŠ¤í‹±', 'ì¿¨í†¤ ë ˆë“œ ë¦½', 'ì‹¤ë²„ ì•„ì´ì„€ë„ìš°', 'ë¸”ë™ ì•„ì´ë¼ì´ë„ˆ'],
                accessory: ['ì‹¤ë²„, í™”ì´íŠ¸ ê³¨ë“œ ì£¼ì–¼ë¦¬', 'ë¸”ë™ ê°€ì£½ ì†Œí’ˆ', 'ì„ ëª…í•œ ì»¬ëŸ¬ì˜ ìŠ¤ì¹´í”„']
            }
        };

        // RGB ê°’ìœ¼ë¡œ í¼ìŠ¤ë„ ì»¬ëŸ¬ ë¶„ì„
        function analyzeColorFromRGB(r, g, b) {
            // 1. ëª…ë„ ê³„ì‚° (ë°ê¸°)
            const brightness = (r + g + b) / 3;
            
            // 2. ì–¸ë”í†¤ ê³„ì‚° (ì›œ/ì¿¨)
            const warmScore = (r - b) + (r - g) * 0.5;
            const isWarm = warmScore > 0;
            
            // 3. ì±„ë„ ê³„ì‚°
            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            const saturation = max - min;
            
            // 4. ê³„ì ˆ íŒë‹¨
            let season;
            let confidence;
            
            if (isWarm) {
                if (brightness > 160 && saturation > 40) {
                    season = 'spring';
                    confidence = Math.min(95, 70 + (brightness - 160) / 2 + saturation / 4);
                } else {
                    season = 'autumn';
                    confidence = Math.min(95, 70 + (200 - brightness) / 3 + saturation / 3);
                }
            } else {
                if (brightness > 160 && saturation < 60) {
                    season = 'summer';
                    confidence = Math.min(95, 70 + (brightness - 160) / 2 + (80 - saturation) / 2);
                } else {
                    season = 'winter';
                    confidence = Math.min(95, 70 + saturation / 2 + Math.abs(brightness - 140) / 2);
                }
            }
            
            return {
                season: season,
                confidence: Math.round(confidence),
                isWarm: isWarm,
                brightness: Math.round(brightness),
                saturation: Math.round(saturation)
            };
        }

        function loadResult() {
            const savedData = JSON.parse(localStorage.getItem('personalColorData') || '{}');
            const userChoice = savedData.finalSeason || 'spring';
            
            // ì¸¡ìƒ‰ê¸° ë¶„ì„
            let colormeterAnalysis = null;
            if (savedData.colorimeter && savedData.colorimeter.average) {
                const rgb = savedData.colorimeter.average;
                colormeterAnalysis = analyzeColorFromRGB(rgb.r, rgb.g, rgb.b);
            }
            
            // ìµœì¢… ê²°ê³¼ ê²°ì • (ì‚¬ìš©ì ì„ íƒ ìš°ì„ )
            const finalSeason = userChoice;
            const data = seasonData[finalSeason];

            // Season info
            document.getElementById('seasonIcon').textContent = data.icon;
            document.getElementById('seasonName').textContent = data.name;
            document.getElementById('seasonType').textContent = data.type;
            document.getElementById('seasonDescription').textContent = data.description;

            // Color palette
            const paletteGrid = document.getElementById('paletteGrid');
            data.colors.forEach(color => {
                const colorDiv = document.createElement('div');
                colorDiv.className = 'palette-color';
                colorDiv.style.backgroundColor = color;
                paletteGrid.appendChild(colorDiv);
            });

            // Recommendations
            const clothingList = document.getElementById('clothingRec');
            data.clothing.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item;
                clothingList.appendChild(li);
            });

            const makeupList = document.getElementById('makeupRec');
            data.makeup.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item;
                makeupList.appendChild(li);
            });

            const accessoryList = document.getElementById('accessoryRec');
            data.accessory.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item;
                accessoryList.appendChild(li);
            });

            // Summary
            const styleNames = { elegant: 'ìš°ì•„í•œ', casual: 'ìºì£¼ì–¼', modern: 'ëª¨ë˜', unique: 'ê°œì„±ìˆëŠ”' };
            document.getElementById('styleSummary').textContent = styleNames[savedData.style] || '-';

            const expectedNames = { spring: 'ë´„ ì›œí†¤', summer: 'ì—¬ë¦„ ì¿¨í†¤', autumn: 'ê°€ì„ ì›œí†¤', winter: 'ê²¨ìš¸ ì¿¨í†¤', unsure: 'ì˜ ëª¨ë¦„' };
            document.getElementById('expectedSummary').textContent = expectedNames[savedData.expected] || '-';

            if (savedData.colorimeter && savedData.colorimeter.average) {
                const rgb = savedData.colorimeter.average;
                document.getElementById('rgbSummary').textContent = `RGB(${rgb.r}, ${rgb.g}, ${rgb.b})`;
            }

            const seasonNames = { spring: 'ë´„ ì›œí†¤', summer: 'ì—¬ë¦„ ì¿¨í†¤', autumn: 'ê°€ì„ ì›œí†¤', winter: 'ê²¨ìš¸ ì¿¨í†¤' };
            document.getElementById('finalSeasonSummary').textContent = seasonNames[userChoice] || '-';
            
            // ë¹„êµ ë¶„ì„ ì¶”ê°€
            if (colormeterAnalysis) {
                addComparisonAnalysis(userChoice, colormeterAnalysis, savedData);
            }
        }

        function addComparisonAnalysis(userChoice, colormeterAnalysis, savedData) {
            const resultCard = document.getElementById('resultCard');
            const expectedNames = { spring: 'ë´„ ì›œí†¤', summer: 'ì—¬ë¦„ ì¿¨í†¤', autumn: 'ê°€ì„ ì›œí†¤', winter: 'ê²¨ìš¸ ì¿¨í†¤', unsure: 'ì˜ ëª¨ë¦„' };
            
            // ë¹„êµ ë¶„ì„ ì„¹ì…˜ ìƒì„±
            const comparisonSection = document.createElement('div');
            comparisonSection.className = 'comparison-analysis';
            comparisonSection.innerHTML = `
                <h3 class="analysis-title" style="margin-top: 3rem; margin-bottom: 2rem;">ğŸ“Š ì¢…í•© ë¶„ì„</h3>
                
                <!-- ì‚¬ìš©ì ì„ íƒ vs ì¸¡ìƒ‰ê¸° ë¶„ì„ -->
                <div class="comparison-grid">
                    <div class="comparison-card user-choice">
                        <div class="comparison-header">
                            <span class="comparison-icon">âœ‹</span>
                            <h4>ë‹¹ì‹ ì˜ ì„ íƒ</h4>
                        </div>
                        <div class="comparison-result">
                            <p class="comparison-season">${seasonData[userChoice].name}</p>
                            <p class="comparison-type">${seasonData[userChoice].type}</p>
                        </div>
                    </div>
                    
                    <div class="comparison-card colorimeter-analysis">
                        <div class="comparison-header">
                            <span class="comparison-icon">ğŸ“±</span>
                            <h4>ì¸¡ìƒ‰ê¸° ë¶„ì„</h4>
                        </div>
                        <div class="comparison-result">
                            <p class="comparison-season">${seasonData[colormeterAnalysis.season].name}</p>
                            <p class="comparison-confidence">ì‹ ë¢°ë„: ${colormeterAnalysis.confidence}%</p>
                        </div>
                    </div>
                </div>
                
                <!-- ì¼ì¹˜ ì—¬ë¶€ -->
                <div class="match-status ${userChoice === colormeterAnalysis.season ? 'match' : 'mismatch'}">
                    <span class="match-icon">${userChoice === colormeterAnalysis.season ? 'âœ…' : 'âš ï¸'}</span>
                    <p class="match-text">
                        ${userChoice === colormeterAnalysis.season 
                            ? 'ë‹¹ì‹ ì˜ ì„ íƒê³¼ ì¸¡ìƒ‰ê¸° ë¶„ì„ì´ ì¼ì¹˜í•©ë‹ˆë‹¤!' 
                            : 'ë‹¹ì‹ ì˜ ì„ íƒê³¼ ì¸¡ìƒ‰ê¸° ë¶„ì„ì´ ë‹¤ë¦…ë‹ˆë‹¤.'}
                    </p>
                </div>
                
                <!-- ìƒì„¸ ë¶„ì„ -->
                <div class="detailed-analysis">
                    <h4 class="detail-title">ğŸ” ìƒì„¸ ë¶„ì„</h4>
                    <div class="analysis-details">
                        <div class="detail-item">
                            <span class="detail-label">í”¼ë¶€ ëª…ë„:</span>
                            <span class="detail-value">${colormeterAnalysis.brightness}/255 ${colormeterAnalysis.brightness > 160 ? '(ë°ìŒ)' : '(ì–´ë‘ì›€)'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">ì–¸ë”í†¤:</span>
                            <span class="detail-value">${colormeterAnalysis.isWarm ? 'ì›œí†¤' : 'ì¿¨í†¤'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">ì±„ë„:</span>
                            <span class="detail-value">${colormeterAnalysis.saturation}/255 ${colormeterAnalysis.saturation > 50 ? '(ë†’ìŒ)' : '(ë‚®ìŒ)'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">ì˜ˆìƒí–ˆë˜ í¼ì»¬:</span>
                            <span class="detail-value">${savedData.expected ? (expectedNames[savedData.expected] || '-') : '-'}</span>
                        </div>
                    </div>
                </div>
                
                <!-- ì „ë¬¸ê°€ ì˜ê²¬ -->
                <div class="expert-opinion">
                    <h4 class="expert-title">ğŸ’¡ THE COVE ì „ë¬¸ê°€ ì˜ê²¬</h4>
                    <div class="opinion-content">
                        ${generateExpertOpinion(userChoice, colormeterAnalysis, savedData)}
                    </div>
                </div>
                
                ${userChoice !== colormeterAnalysis.season ? generateCompromise(userChoice, colormeterAnalysis.season) : ''}
            `;
            
            // ë°ì´í„° ìš”ì•½ ë°”ë¡œ ì•ì— ì‚½ì…
            const dataSummary = resultCard.querySelector('.data-summary');
            resultCard.insertBefore(comparisonSection, dataSummary);
        }

        function generateExpertOpinion(userChoice, analysis, savedData) {
            const isMatch = userChoice === analysis.season;
            
            if (isMatch) {
                return `
                    <p><strong>ì¶•í•˜í•©ë‹ˆë‹¤!</strong> ë‹¹ì‹ ì˜ ì§ê´€ê³¼ ì¸¡ìƒ‰ê¸° ë¶„ì„ì´ ì™„ë²½í•˜ê²Œ ì¼ì¹˜í•©ë‹ˆë‹¤.</p>
                    <p>ì¸¡ìƒ‰ê¸° ë°ì´í„°(ëª…ë„: ${analysis.brightness}, ì±„ë„: ${analysis.saturation})ê°€ 
                    <strong>${seasonData[userChoice].name}</strong>ì„ ëª…í™•íˆ ì§€ì§€í•©ë‹ˆë‹¤.</p>
                    <p>ì‹ ë¢°ë„ ${analysis.confidence}%ë¡œ ë§¤ìš° ë†’ì€ ì •í™•ë„ë¥¼ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤. ìì‹ ê°ì„ ê°€ì§€ê³  ì¶”ì²œ ì»¬ëŸ¬ íŒ”ë ˆíŠ¸ë¥¼ í™œìš©í•˜ì„¸ìš”!</p>
                `;
            }
            
            const userTone = userChoice === 'spring' || userChoice === 'autumn' ? 'warm' : 'cool';
            const analysisTone = analysis.isWarm ? 'warm' : 'cool';
            
            if (userTone === analysisTone) {
                // ê°™ì€ í†¤ì´ì§€ë§Œ ë‹¤ë¥¸ ê³„ì ˆ
                return `
                    <p>ë‹¹ì‹ ì˜ ì„ íƒê³¼ ì¸¡ìƒ‰ê¸° ë¶„ì„ ëª¨ë‘ <strong>${userTone === 'warm' ? 'ì›œí†¤' : 'ì¿¨í†¤'}</strong>ì„ ê°€ë¦¬í‚µë‹ˆë‹¤.</p>
                    <p>ë‹¤ë§Œ ëª…ë„(${analysis.brightness})ì™€ ì±„ë„(${analysis.saturation})ì˜ ì°¨ì´ë¡œ 
                    ${seasonData[userChoice].name}ê³¼ ${seasonData[analysis.season].name} ì‚¬ì´ì—ì„œ 
                    ê³ ë¯¼ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    <p>ë‘ ê³„ì ˆ ëª¨ë‘ ê°™ì€ í†¤ì´ë¯€ë¡œ, ì–‘ìª½ì˜ ì»¬ëŸ¬ë¥¼ ëª¨ë‘ ì‹œë„í•´ë³´ì‹œëŠ” ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤. 
                    íŠ¹íˆ íƒ€í˜‘ì•ˆ ì»¬ëŸ¬ íŒ”ë ˆíŠ¸ê°€ ë‹¹ì‹ ì—ê²Œ ê°€ì¥ ì˜ ì–´ìš¸ë¦´ ê²ƒì…ë‹ˆë‹¤.</p>
                `;
            } else {
                // ë‹¤ë¥¸ í†¤
                return `
                    <p>í¥ë¯¸ë¡­ê²Œë„ ë‹¹ì‹ ì˜ ì„ íƒ(${seasonData[userChoice].name})ê³¼ ì¸¡ìƒ‰ê¸° ë¶„ì„(${seasonData[analysis.season].name})ì´ 
                    <strong>ì›œ/ì¿¨ í†¤ì—ì„œ ì°¨ì´</strong>ë¥¼ ë³´ì…ë‹ˆë‹¤.</p>
                    <p>ì¸¡ìƒ‰ê¸°ëŠ” ëª…ë„ ${analysis.brightness}, ì±„ë„ ${analysis.saturation}ì„ ê¸°ë°˜ìœ¼ë¡œ 
                    ${analysis.isWarm ? 'ì›œí†¤' : 'ì¿¨í†¤'}ì„ ì œì‹œí–ˆì§€ë§Œ, ë‹¹ì‹ ì€ ${userChoice === 'spring' || userChoice === 'autumn' ? 'ì›œí†¤' : 'ì¿¨í†¤'}ì„ ì„ íƒí–ˆìŠµë‹ˆë‹¤.</p>
                    <p>ì´ëŸ° ê²½ìš°, <strong>ë‹¹ì‹ ì˜ ì„ íƒ</strong>ì´ ë” ì¤‘ìš”í•©ë‹ˆë‹¤. 
                    ê±°ìš¸ì„ ë³´ê³  ì§ì ‘ ëŠë‚€ ë‹¹ì‹ ì˜ íŒë‹¨ì„ ì‹ ë¢°í•˜ì„¸ìš”. 
                    ë‹¤ë§Œ íƒ€í˜‘ì•ˆ ì»¬ëŸ¬ë„ ì‹œë„í•´ë³´ë©´ ìƒˆë¡œìš´ ë°œê²¬ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                `;
            }
        }

        function generateCompromise(userChoice, analysisSeason) {
            const compromiseColors = getCompromiseColors(userChoice, analysisSeason);
            
            return `
                <div class="compromise-section">
                    <h4 class="compromise-title">ğŸ¨ íƒ€í˜‘ì•ˆ: ë‘ ê³„ì ˆì˜ ì¡°í™”</h4>
                    <p class="compromise-intro">
                        ${seasonData[userChoice].name}ê³¼ ${seasonData[analysisSeason].name}ì˜ 
                        ê³µí†µ ì˜ì—­ì—ì„œ ê°€ì¥ ì˜ ì–´ìš¸ë¦¬ëŠ” ì»¬ëŸ¬ë“¤ì…ë‹ˆë‹¤.
                    </p>
                    <div class="compromise-palette">
                        ${compromiseColors.map(color => `
                            <div class="compromise-color" style="background: ${color};"></div>
                        `).join('')}
                    </div>
                    <div class="compromise-tips">
                        <p><strong>í™œìš© íŒ:</strong></p>
                        <ul>
                            <li>${seasonData[userChoice].name} ì»¬ëŸ¬ë¥¼ ë©”ì¸ìœ¼ë¡œ ì‚¬ìš©</li>
                            <li>íƒ€í˜‘ì•ˆ ì»¬ëŸ¬ë¡œ í¬ì¸íŠ¸ ì£¼ê¸°</li>
                            <li>${seasonData[analysisSeason].name} ì»¬ëŸ¬ëŠ” ì•¡ì„¸ì„œë¦¬ë¡œ í™œìš©</li>
                            <li>ìƒí™©ì— ë”°ë¼ ìœ ì—°í•˜ê²Œ ë¯¹ìŠ¤ ë§¤ì¹˜</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        function getCompromiseColors(season1, season2) {
            const compromises = {
                'spring-summer': ['#FFB6D9', '#B3E5DD', '#FFD4B3', '#C8B3E6'],
                'spring-autumn': ['#FFD4A3', '#E6C8A3', '#FFB38F', '#D4AF9A'],
                'spring-winter': ['#FFB3D9', '#E6B3FF', '#FF99CC', '#CC99FF'],
                'summer-autumn': ['#C8AF9A', '#B3A89A', '#A89ABF', '#9A8FB3'],
                'summer-winter': ['#B3C8E6', '#A3B3D9', '#C8B3E6', '#B3A3D9'],
                'autumn-winter': ['#8B7A73', '#9A8A83', '#8B738A', '#9A8399']
            };
            
            const key1 = `${season1}-${season2}`;
            const key2 = `${season2}-${season1}`;
            
            return compromises[key1] || compromises[key2] || ['#C8C8C8', '#B3B3B3', '#A8A8A8', '#9A9A9A'];
        }

        async function downloadPDF() {
            const loadingOverlay = document.getElementById('loadingOverlay');
            loadingOverlay.style.display = 'flex';

            try {
                const { jsPDF } = window.jspdf;
                const resultCard = document.getElementById('resultCard');

                // Capture the result card as canvas
                const canvas = await html2canvas(resultCard, {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#ffffff'
                });

                // Create PDF
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });

                const imgWidth = 210; // A4 width in mm
                const imgHeight = (canvas.height * imgWidth) / canvas.width;

                pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
                pdf.save('THE_COVE_Personal_Color_Result.pdf');

            } catch (error) {
                console.error('PDF ìƒì„± ì˜¤ë¥˜:', error);
                alert('PDF ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            } finally {
                loadingOverlay.style.display = 'none';
            }
        }

        function restartDiagnosis() {
            if (confirm('ì§„ë‹¨ì„ ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('personalColorData');
                window.location.href = 'pcolor1.html';
            }
        }

        function goHome() {
            window.location.href = 'index.html';
        }

        window.onload = loadResult;
    </script>
</body>
</html>
